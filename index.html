<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frachtkosten-Rechner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            padding: 0;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/></pattern></defs><rect width="1200" height="800" fill="url(%23grid)"/></svg>');
            pointer-events: none;
            z-index: 0;
        }

        header {
            background: linear-gradient(135deg, #e94560 0%, #ff6b35 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(233, 69, 96, 0.3);
            position: relative;
            z-index: 10;
        }

        header h1 {
            font-size: 28px;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        header p {
            margin: 8px 0 0 0;
            font-size: 14px;
            opacity: 0.9;
        }

        nav {
            background: rgba(15, 52, 96, 0.95);
            backdrop-filter: blur(10px);
            padding: 0;
            border-bottom: 2px solid #e94560;
            display: flex;
            gap: 0;
            position: relative;
            z-index: 9;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }

        nav a:hover,
        nav a.active {
            background: rgba(233, 69, 96, 0.2);
            border-bottom-color: #e94560;
            color: #ff6b35;
        }

        .main-content {
            position: relative;
            z-index: 5;
            padding: 30px 20px;
            min-height: calc(100vh - 140px);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 35px;
            backdrop-filter: blur(5px);
        }

        h2 {
            color: #1a1a2e;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 3px solid #e94560;
            padding-bottom: 12px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #1a1a2e;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select {
            width: 100%;
            padding: 14px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            color: #1a1a2e;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #e94560;
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
        }

        .address-results {
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            background: white;
            position: absolute;
            width: 100%;
            top: 100%;
            left: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .address-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
            color: #333;
        }

        .address-result-item:hover {
            background: #f5f5f5;
            color: #e94560;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #e94560 0%, #ff6b35 100%);
            color: white;
            border: none;
            padding: 16px 35px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 20px rgba(233, 69, 96, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(233, 69, 96, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .result-box {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f4f8 100%);
            border-radius: 12px;
            display: none;
            border-left: 5px solid #e94560;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid rgba(26, 26, 46, 0.1);
            align-items: center;
        }

        .result-item:last-child {
            border-bottom: none;
            font-size: 22px;
            font-weight: 700;
            color: #e94560;
            margin-top: 15px;
            padding-top: 20px;
            border-top: 2px solid #e94560;
        }

        .result-label {
            font-weight: 600;
            color: #1a1a2e;
        }

        .result-value {
            color: #0f3460;
            font-weight: 700;
        }

        .loading {
            text-align: center;
            color: #e94560;
            display: none;
            margin-top: 20px;
            font-weight: 600;
        }

        .error {
            background: #fee;
            border-left: 4px solid #e94560;
            border-radius: 8px;
            color: #c33;
            padding: 15px;
            display: none;
            margin-top: 20px;
            font-weight: 500;
        }

        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-left: 4px solid #e94560;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
            font-size: 14px;
            color: #1a1a2e;
        }

        .info-box strong {
            color: #e94560;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            nav {
                flex-wrap: wrap;
            }

            nav a {
                flex: 1 0 50%;
                padding: 12px 15px;
                font-size: 14px;
            }

            header h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üöö Frachtkosten-Rechner</h1>
        <p>Berechnung der Transportkosten f√ºr Logistik und Warenwirtschaft</p>
    </header>

    <nav>
        <a href="#" class="nav-item active" data-section="calculator">üíº Kalkulator</a>
        <a href="#" class="nav-item" data-section="info">‚ÑπÔ∏è Information</a>
        <a href="#" class="nav-item" data-section="faq">‚ùì FAQ</a>
    </nav>

    <div class="main-content">
        <div class="container" id="calculator-section">
            <h2>Frachtkosten berechnen</h2>

            <div class="info-box">
                <strong>‚ÑπÔ∏è Hinweis:</strong> Die Preise gelten f√ºr Transporte innerhalb Deutschlands. Bei internationalen Fahrten oder Sonderfahrten kontaktieren Sie uns bitte direkt.
            </div>

            <form id="freightForm">
                <div class="form-group">
                    <label for="startAddress">Abgangsort (Adresse oder Unternehmen)</label>
                    <input type="text" id="startAddress" placeholder="z.B. Stra√üe 1, 35390 Gie√üen oder Unternehmensname" required>
                    <div id="startResults" class="address-results"></div>
                </div>

                <div class="form-group">
                    <label for="endAddress">Bestimmungsort (Adresse oder Unternehmen)</label>
                    <input type="text" id="endAddress" placeholder="z.B. Stra√üe 1, 60311 Frankfurt oder Unternehmensname" required>
                    <div id="endResults" class="address-results"></div>
                </div>

                <div class="two-column">
                    <div class="form-group">
                        <label for="weight">Gesamtgewicht der Ger√§te</label>
                        <select id="weight" required>
                            <option value="">Bitte w√§hlen...</option>
                            <option value="1500">< 1.500 kg</option>
                            <option value="3000">< 3.000 kg</option>
                            <option value="5000">< 5.000 kg</option>
                            <option value="7500">< 7.500 kg</option>
                            <option value="10000">< 10.000 kg</option>
                            <option value="23000">< 23.000 kg</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="height">Bauh√∂he (optional)</label>
                        <select id="height">
                            <option value="0">Standard (< 3,01 m)</option>
                            <option value="125">ab 3,01 m (+125 ‚Ç¨)</option>
                            <option value="250">ab 3,41 m (+250 ‚Ç¨)</option>
                            <option value="375">ab 3,71 m (+375 ‚Ç¨)</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn">Kosten berechnen</button>
            </form>

            <div class="loading" id="loading">
                <p>‚è≥ Berechne Entfernung und Kosten...</p>
            </div>

            <div class="error" id="error"></div>

            <div class="result-box" id="resultBox">
                <div class="result-item">
                    <span class="result-label">Transportstrecke:</span>
                    <span class="result-value" id="routeInfo"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Entfernung:</span>
                    <span class="result-value" id="distance"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Gewicht:</span>
                    <span class="result-value" id="weightDisplay"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Basispreis:</span>
                    <span class="result-value" id="basePrice"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">Zuschlag Bauh√∂he:</span>
                    <span class="result-value" id="heightSurcharge"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">üí∞ Gesamtpreis:</span>
                    <span class="result-value" id="totalPrice"></span>
                </div>
            </div>
        </div>

        <div class="container" id="info-section" style="display: none;">
            <h2>Informationen zur Frachtberechnung</h2>
            <div class="info-box">
                <h3 style="color: #e94560; margin-top: 0;">Wie funktioniert der Rechner?</h3>
                <p>Der Frachtrechner basiert auf einer standardisierten Preismatrix, die folgende Faktoren ber√ºcksichtigt:</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>Gewichtsklasse:</strong> Das Gesamtgewicht der G√ºter bestimmt die Grundgeb√ºhr</li>
                    <li><strong>Entfernung:</strong> Die tats√§chliche Fahrtstrecke zwischen Abgangs- und Bestimmungsort</li>
                    <li><strong>Bauh√∂he:</strong> Zusatzgeb√ºhren f√ºr Ger√§te √ºber 3 Meter H√∂he</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Alle Preise verstehen sich inklusive MwSt. und gelten nur f√ºr Transporte innerhalb Deutschlands.</strong></p>
            </div>
        </div>

        <div class="container" id="faq-section" style="display: none;">
            <h2>H√§ufig gestellte Fragen</h2>
            <div class="info-box">
                <p><strong>F: Wie wird die Entfernung berechnet?</strong><br>
                A: Wir nutzen die tats√§chliche Stra√üenentfernung zwischen den eingegebenen Adressen basierend auf kartografischen Daten.</p>
                
                <p style="margin-top: 15px;"><strong>F: Gelten die Preise auch au√üerhalb Deutschlands?</strong><br>
                A: Nein, die angezeigten Preise gelten nur innerhalb Deutschlands. F√ºr Exporte oder Importe kontaktieren Sie uns bitte direkt.</p>
                
                <p style="margin-top: 15px;"><strong>F: Kann ich R√ºckl√§digungen buchen?</strong><br>
                A: Ja, R√ºckladigungen sind mit 70% Rabatt m√∂glich. Bitte kontaktieren Sie uns f√ºr weitere Details.</p>
                
                <p style="margin-top: 15px;"><strong>F: Was ist mit zus√§tzlichen Wartezeiten?</strong><br>
                A: Zus√§tzliche Arbeiten und Wartezeiten werden mit 40‚Ç¨ pro halbe Stunde berechnet.</p>
            </div>
        </div>
    </div>

    <script>
        // Navigationssystem
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;
                
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                document.querySelectorAll('[id$="-section"]').forEach(s => s.style.display = 'none');
                document.getElementById(section + '-section').style.display = 'block';
            });
        });

        // Frachtkostentabelle
        const priceTable = {
            1500: { 30: 150, 50: 180, 100: 200, 150: 230, 300: 340, 450: 400, 600: 480 },
            3000: { 30: 160, 50: 190, 100: 270, 150: 400, 300: 540, 450: 670, 600: 870 },
            5000: { 30: 180, 50: 220, 100: 340, 150: 470, 300: 630, 450: 755, 600: 910 },
            7500: { 30: 200, 50: 260, 100: 370, 150: 540, 300: 700, 450: 870, 600: 960 },
            10000: { 30: 230, 50: 280, 100: 430, 150: 605, 300: 750, 450: 935, 600: 1110 },
            23000: { 30: 280, 50: 350, 100: 480, 150: 640, 300: 830, 450: 1040, 600: 1175 }
        };

        let startCoords = null;
        let endCoords = null;
        let debounceTimer;

        async function searchAddress(query, resultsDiv) {
            if (query.length < 3) {
                resultsDiv.style.display = 'none';
                return;
            }

            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ', Deutschland')}&limit=5&addressdetails=1`
                );
                const results = await response.json();

                if (results.length > 0) {
                    resultsDiv.innerHTML = '';
                    results.forEach(result => {
                        const div = document.createElement('div');
                        div.className = 'address-result-item';
                        div.textContent = result.display_name;
                        div.onclick = () => selectAddress(result, resultsDiv);
                        resultsDiv.appendChild(div);
                    });
                    resultsDiv.style.display = 'block';
                } else {
                    resultsDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('Fehler bei der Adresssuche:', error);
            }
        }

        function selectAddress(result, resultsDiv) {
            const input = resultsDiv.previousElementSibling;
            input.value = result.display_name;

            if (resultsDiv.id === 'startResults') {
                startCoords = { lat: parseFloat(result.lat), lon: parseFloat(result.lon) };
            } else {
                endCoords = { lat: parseFloat(result.lat), lon: parseFloat(result.lon) };
            }

            resultsDiv.style.display = 'none';
        }

        document.getElementById('startAddress').addEventListener('input', (e) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                searchAddress(e.target.value, document.getElementById('startResults'));
            }, 300);
        });

        document.getElementById('endAddress').addEventListener('input', (e) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                searchAddress(e.target.value, document.getElementById('endResults'));
            }, 300);
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.form-group')) {
                document.querySelectorAll('.address-results').forEach(div => {
                    div.style.display = 'none';
                });
            }
        });

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function getPriceForDistance(weight, distance) {
            const distanceRanges = [30, 50, 100, 150, 300, 450, 600];

            for (let range of distanceRanges) {
                if (distance <= range) {
                    return priceTable[weight][range];
                }
            }

            return priceTable[weight][600];
        }

        document.getElementById('freightForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const errorDiv = document.getElementById('error');
            const loadingDiv = document.getElementById('loading');
            const resultBox = document.getElementById('resultBox');
            const startAddressInput = document.getElementById('startAddress');
            const endAddressInput = document.getElementById('endAddress');
            const weightSelect = document.getElementById('weight');

            errorDiv.style.display = 'none';
            resultBox.style.display = 'none';
            let hasError = false;

            // Validierung: Startadresse
            if (!startAddressInput.value.trim()) {
                errorDiv.textContent = '‚ö†Ô∏è Fehler: Bitte geben Sie eine Startadresse ein.';
                errorDiv.style.display = 'block';
                startAddressInput.focus();
                return;
            }

            if (!startCoords) {
                errorDiv.textContent = '‚ö†Ô∏è Fehler: Startadresse nicht erkannt. Bitte w√§hlen Sie eine Adresse aus den Vorschl√§gen.';
                errorDiv.style.display = 'block';
                startAddressInput.focus();
                return;
            }

            // Validierung: Zieladresse
            if (!endAddressInput.value.trim()) {
                errorDiv.textContent = '‚ö†Ô∏è Fehler: Bitte geben Sie eine Zieladresse ein.';
                errorDiv.style.display = 'block';
                endAddressInput.focus();
                return;
            }

            if (!endCoords) {
                errorDiv.textContent = '‚ö†Ô∏è Fehler: Zieladresse nicht erkannt. Bitte w√§hlen Sie eine Adresse aus den Vorschl√§gen.';
                errorDiv.style.display = 'block';
                endAddressInput.focus();
                return;
            }

            // Validierung: Gleiches Start- und Zielort
            const sameLocation = Math.abs(startCoords.lat - endCoords.lat) < 0.001 && 
                                 Math.abs(startCoords.lon - endCoords.lon) < 0.001;
            if (sameLocation) {
                errorDiv.textContent = '‚ö†Ô∏è Fehler: Start- und Zielort sind identisch. Bitte unterschiedliche Orte angeben.';
                errorDiv.style.display = 'block';
                return;
            }

            // Validierung: Gewicht
            const weight = parseInt(weightSelect.value);
            if (!weight || weight <= 0) {
                errorDiv.textContent = '‚ö†Ô∏è Fehler: Bitte w√§hlen Sie eine g√ºltige Gewichtsklasse aus.';
                errorDiv.style.display = 'block';
                weightSelect.focus();
                return;
            }

            const heightSurcharge = parseInt(document.getElementById('height').value);

            loadingDiv.style.display = 'block';

            try {
                const distance = calculateDistance(
                    startCoords.lat, startCoords.lon,
                    endCoords.lat, endCoords.lon
                );

                // Validierung: Minimale Entfernung
                if (distance < 1) {
                    loadingDiv.style.display = 'none';
                    errorDiv.textContent = '‚ö†Ô∏è Fehler: Die Entfernung ist zu kurz (< 1 km). Bitte g√ºltige Orte angeben.';
                    errorDiv.style.display = 'block';
                    return;
                }

                // Validierung: Maximale Entfernung
                if (distance > 1000) {
                    loadingDiv.style.display = 'none';
                    errorDiv.textContent = '‚ö†Ô∏è Warnung: Die Entfernung betr√§gt √ºber 1000 km. Bitte kontaktieren Sie uns f√ºr ein Angebot.';
                    errorDiv.style.display = 'block';
                    return;
                }

                const basePrice = getPriceForDistance(weight, distance);
                
                // Validierung: Preis existiert
                if (!basePrice || basePrice <= 0) {
                    loadingDiv.style.display = 'none';
                    errorDiv.textContent = '‚ùå Fehler: Keine g√ºltige Preisberechnung m√∂glich. Bitte √ºberpr√ºfen Sie Ihre Angaben.';
                    errorDiv.style.display = 'block';
                    return;
                }

                const totalPrice = basePrice + heightSurcharge;

                const startAddr = startAddressInput.value.split(',')[0];
                const endAddr = endAddressInput.value.split(',')[0];

                document.getElementById('routeInfo').textContent = `${startAddr} ‚Üí ${endAddr}`;
                document.getElementById('distance').textContent = `${Math.round(distance)} km`;

                const weightLabels = {
                    1500: '< 1.500 kg',
                    3000: '< 3.000 kg',
                    5000: '< 5.000 kg',
                    7500: '< 7.500 kg',
                    10000: '< 10.000 kg',
                    23000: '< 23.000 kg'
                };
                document.getElementById('weightDisplay').textContent = weightLabels[weight];

                document.getElementById('basePrice').textContent = `${basePrice} ‚Ç¨`;
                document.getElementById('heightSurcharge').textContent = heightSurcharge > 0 ? `+ ${heightSurcharge} ‚Ç¨` : 'Kein Zuschlag';
                document.getElementById('totalPrice').textContent = `${totalPrice} ‚Ç¨`;

                loadingDiv.style.display = 'none';
                resultBox.style.display = 'block';

                resultBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.textContent = '‚ùå Fehler bei der Berechnung: ' + error.message + '. Bitte versuchen Sie es erneut.';
                errorDiv.style.display = 'block';
                console.error('Berechnungsfehler:', error);
            }
        });
    </script>
</body>
</html>
